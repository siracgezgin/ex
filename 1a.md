# ⚽ Angular Futbol Ligi Simülasyonu - Angular 18 Başlangıç Rehberi

## 📋 Proje Genel Bakış

Bu proje, **futbol ligi simülasyonu** için geliştirilmiş bir Angular uygulamasıdır. Angular 18'den başlayıp 20'ye geçiş yapacağız.

### 🎯 Ana Amaç
- **Liga başlatma** ve **takım yönetimi**
- **Fikstür oluşturma** (Round Robin algoritması)
- **Maç simülasyonu** ve **sonuç hesaplama**
- **Puan tablosu** ve **şampiyonluk ihtimalleri**

---

## 🏗️ Teknoloji Stack'i (Angular 18 Başlangıç)

```json
{
  "name": "futbol-ligi-simulasyonu",
  "version": "0.0.0",
  "scripts": {
    "ng": "ng",
    "start": "ng serve",
    "build": "ng build --configuration=production",
    "test": "ng test",
    "lint": "ng lint"
  },
  "dependencies": {
    "@angular/animations": "^18.2.4",
    "@angular/common": "^18.2.4",
    "@angular/compiler": "^18.2.4",
    "@angular/core": "^18.2.4",
    "@angular/forms": "^18.2.4",
    "@angular/platform-browser": "^18.2.4",
    "@angular/platform-browser-dynamic": "^18.2.4",
    "@angular/router": "^18.2.4",
    "@ngrx/effects": "^18.0.2",
    "@ngrx/store": "^18.0.2",
    "@ngrx/store-devtools": "^18.0.2",
    "bootstrap": "^5.3.2",
    "primeng": "^17.18.11",
    "primeicons": "^7.0.0",
    "rxjs": "^7.8.1",
    "tailwindcss": "^3.0.0",
    "tslib": "^2.6.2",
    "zone.js": "~0.14.3"
  },
  "devDependencies": {
    "@angular-devkit/build-angular": "^18.2.4",
    "@angular/cli": "~18.2.4",
    "@angular/compiler-cli": "^18.2.4",
    "@types/jasmine": "~5.1.4",
    "autoprefixer": "^10.4.21",
    "jasmine-core": "~5.1.1",
    "karma": "^6.3.0",
    "karma-chrome-launcher": "~3.2.0",
    "karma-coverage": "~2.2.1",
    "karma-jasmine": "^4.0.2",
    "karma-jasmine-html-reporter": "^1.7.0",
    "postcss": "^8.5.6",
    "typescript": "~5.5.4"
  }
}
```

---

## 🚀 Adım Adım Kurulum ve Geliştirme

### 🔧 **1. PROJE KURULUMU (30 dakika)**

#### 1.1 Angular 18 Kurulumu
```bash
# Angular CLI 18 kurulumu
npm install -g @angular/cli@18.2.4

# Proje oluşturma
ng new futbol-ligi-simulasyonu --routing --style=scss --skip-git

# Proje dizinine geçiş
cd futbol-ligi-simulasyonu

# Gerekli paketlerin kurulumu
npm install @ngrx/store@18 @ngrx/effects@18 @ngrx/store-devtools@18
npm install primeng@17.18.11 primeicons@7
npm install bootstrap@5.3.2
npm install -D tailwindcss@3.0 autoprefixer@10.4.21 postcss@8.5.6

# Tailwind CSS kurulumu
npx tailwindcss init -p

# Başlatma
ng serve
```

#### 1.2 Klasör Yapısını Oluşturma
```bash
# Windows (PowerShell)
New-Item -ItemType Directory -Path "src\app\common\models" -Force
New-Item -ItemType Directory -Path "src\app\common\services" -Force  
New-Item -ItemType Directory -Path "src\app\store\league" -Force
New-Item -ItemType Directory -Path "src\app\league\league-dashboard" -Force
New-Item -ItemType Directory -Path "src\app\league\standings-table" -Force
New-Item -ItemType Directory -Path "src\app\league\match-results" -Force
New-Item -ItemType Directory -Path "src\assets\i18n" -Force
New-Item -ItemType Directory -Path "src\assets\styles" -Force

# Linux/Mac
mkdir -p src/app/common/models
mkdir -p src/app/common/services
mkdir -p src/app/store/league
mkdir -p src/app/league/league-dashboard
mkdir -p src/app/league/standings-table
mkdir -p src/app/league/match-results
mkdir -p src/assets/i18n
mkdir -p src/assets/styles
```

---

### 📁 **2. MODEL DOSYALARINI OLUŞTURMA (45 dakika)**

#### 2.1 Team Model (src/app/common/models/team.model.ts)
```typescript
/**
 * Takım modeli - Futbol takımının temel bilgilerini ve istatistiklerini içerir
 */
export interface ITeam {
  /** Takımın benzersiz kimlik numarası */
  id: number;
  /** Takım adı */
  name: string;
  /** Oynanan maç sayısı */
  played: number;
  /** Kazanılan maç sayısı */
  won: number;
  /** Berabere biten maç sayısı */
  drawn: number;
  /** Kaybedilen maç sayısı */
  lost: number;
  /** Atılan gol sayısı */
  goalsFor: number;
  /** Yenilen gol sayısı */
  goalsAgainst: number;
  /** Gol farkı (atılan - yenilen) */
  goalDifference: number;
  /** Toplam puan (galibiyet: 3, beraberlik: 1) */
  points: number;
  /** Takım gücü (1-5 arası değer, simülasyonda kullanılır) */
  strength: number;
}

/**
 * Takım istatistikleri - Takım bilgileri ve sıralama pozisyonu
 */
export interface ITeamStats {
  /** Takım bilgileri */
  team: ITeam;
  /** Lig sıralamasındaki pozisyonu */
  position: number;
  /** Şampiyonluk ihtimali yüzdesi (opsiyonel) */
  championshipChance?: number;
  /** Şampiyonluk şansının olup olmadığı */
  isChampionshipPossible?: boolean;
}
```

#### 2.2 Match Model (src/app/common/models/match.model.ts)
```typescript
/**
 * Maç sonucu enum'u
 */
export enum MatchResult {
  HOME_WIN = 'HOME_WIN',
  AWAY_WIN = 'AWAY_WIN',
  DRAW = 'DRAW'
}

/**
 * Maç modeli - Futbol maçının bilgilerini içerir
 */
export interface IMatch {
  /** Maçın benzersiz kimlik numarası */
  id: number;
  /** Hafta numarası */
  week: number;
  /** Ev sahibi takım bilgileri */
  homeTeam: {
    id: number;
    name: string;
  };
  /** Deplasman takım bilgileri */
  awayTeam: {
    id: number;
    name: string;
  };
  /** Ev sahibi takımın gol sayısı */
  homeScore: number | null;
  /** Deplasman takımın gol sayısı */
  awayScore: number | null;
  /** Maçın oynanıp oynanmadığı */
  isPlayed: boolean;
  /** Maç sonucu */
  result?: MatchResult;
}

/**
 * Haftalık maçlar - Belirli bir haftadaki tüm maçları içerir
 */
export interface IWeekMatches {
  /** Hafta numarası */
  week: number;
  /** O haftadaki maçlar */
  matches: IMatch[];
}

/**
 * Maç düzenleme - Maç sonucunu manuel olarak düzenlemek için
 */
export interface IMatchEdit {
  /** Düzenlenecek maçın ID'si */
  matchId: number;
  /** Ev sahibi takımın gol sayısı */
  homeScore: number;
  /** Deplasman takımın gol sayısı */
  awayScore: number;
}
```

#### 2.3 League Constants (src/app/common/models/league.constants.ts)
```typescript
/**
 * Liga sabitleri - Oyun kuralları ve konfigürasyon değerleri
 */
export const LEAGUE_CONSTANTS = {
  /** Puan sistemi */
  POINTS: {
    WIN: 3,
    DRAW: 1,
    LOSS: 0
  },
  /** Takım sayısı */
  TEAM_COUNT: 4,
  /** Toplam hafta sayısı (çift devreli lig) */
  TOTAL_WEEKS: 6,
  /** Takım isimleri */
  TEAM_NAMES: [
    'Galatasaray',
    'Fenerbahçe', 
    'Beşiktaş',
    'Trabzonspor'
  ],
  /** Takım gücü aralığı */
  TEAM_STRENGTH: {
    MIN: 1,
    MAX: 5,
    DEFAULT: 3
  }
};

/** Şampiyonluk hesaplama başlangıç haftası */
export const CHAMPIONSHIP_CALCULATION_START_WEEK = 4;
```

#### 2.4 League State (src/app/common/models/league-state.model.ts)
```typescript
import { ITeam, ITeamStats } from './team.model';
import { IMatch, IWeekMatches } from './match.model';

/**
 * Liga state modeli - NgRx store için state yapısı
 */
export interface ILeagueState {
  /** Tüm takımlar */
  teams: ITeam[];
  /** Tüm maçlar */
  matches: IMatch[];
  /** Puan tablosu */
  standings: ITeamStats[];
  /** Haftalık maçlar */
  weeklyMatches: IWeekMatches[];
  /** Mevcut hafta */
  currentWeek: number;
  /** Sezonun bitip bitmediği */
  isSeasonFinished: boolean;
  /** Şampiyon takım */
  champion: ITeam | null;
  /** Yükleme durumu */
  loading: boolean;
  /** Hata mesajı */
  error: string | null;
}

/**
 * Başlangıç state değerleri
 */
export const initialLeagueState: ILeagueState = {
  teams: [],
  matches: [],
  standings: [],
  weeklyMatches: [],
  currentWeek: 1,
  isSeasonFinished: false,
  champion: null,
  loading: false,
  error: null
};
```

---

### 🔧 **3. LIGA SIMÜLASYON SERVİSİ (2-3 saat)**

#### 3.1 League Simulation Service (src/app/common/services/league-simulation.service.ts)
```typescript
import { Injectable } from '@angular/core';
import { Observable, of } from 'rxjs';
import { delay } from 'rxjs/operators';
import { ITeam, IMatch, MatchResult, IMatchEdit } from '../models';
import { LEAGUE_CONSTANTS } from '../models/league.constants';

/**
 * Liga simülasyon servisi - Takım yönetimi, fikstür oluşturma ve maç simülasyonu
 */

@Injectable({
  providedIn: 'root'
})
export class LeagueSimulationService {
  
  /**
   * Takımları başlatır ve rastgele güç değerleri atar
   * @returns Observable<ITeam[]> - Başlatılan takımlar
   */
  initializeTeams(): Observable<ITeam[]> {
    const teams: ITeam[] = LEAGUE_CONSTANTS.TEAM_NAMES.map((name, index) => ({
      id: index + 1,
      name,
      played: 0,
      won: 0,
      drawn: 0,
      lost: 0,
      goalsFor: 0,
      goalsAgainst: 0,
      goalDifference: 0,
      points: 0,
      strength: this.getRandomTeamStrength()
    }));

    return of(teams).pipe(delay(500));
  }

  /**
   * Round Robin algoritması ile fikstür oluşturur
   * @param teams - Takım listesi
   * @returns Observable<IMatch[]> - Oluşturulan maçlar
   */
  generateFixture(teams: ITeam[]): Observable<IMatch[]> {
    const firstHalfMatches = this.generateFirstHalfMatches(teams);
    const secondHalfMatches = this.generateSecondHalfMatches(firstHalfMatches);
    
    return of([...firstHalfMatches, ...secondHalfMatches]).pipe(delay(300));
  }

  /**
   * Belirli bir haftanın maçlarını simüle eder
   * @param matches - Tüm maçlar
   * @param currentWeek - Oynatılacak hafta
   * @returns Observable<IMatch[]> - Güncellenmiş maçlar
   */
  playWeekMatches(matches: IMatch[], currentWeek: number): Observable<IMatch[]> {
    const weekMatches = matches.filter(match => 
      match.week === currentWeek && !match.isPlayed
    );
    
    const updatedMatches = weekMatches.map(match => {
      const homeStrength = this.getTeamStrengthById(match.homeTeam.id);
      const awayStrength = this.getTeamStrengthById(match.awayTeam.id);
      
      const result = this.simulateMatch(
        match.homeTeam.id,
        match.awayTeam.id,
        homeStrength,
        awayStrength
      );

      return {
        ...match,
        homeScore: result.homeScore,
        awayScore: result.awayScore,
        isPlayed: true,
        result: result.result
      };
    });

    return of(updatedMatches).pipe(delay(800));
  }

  // Tüm sezon oynatma
  playAllRemainingSeason(matches: Match[], currentWeek: number): Observable<Match[]> {
    const unplayedMatches = matches.filter(match => 
      match.week >= currentWeek && !match.isPlayed
    );
    
    const updatedMatches = unplayedMatches.map(match => {
      const homeStrength = this.getTeamStrengthById(match.homeTeam.id);
      const awayStrength = this.getTeamStrengthById(match.awayTeam.id);
      
      const result = this.simulateMatch(
        match.homeTeam.id,
        match.awayTeam.id,
        homeStrength,
        awayStrength
      );

      return {
        ...match,
        homeScore: result.homeScore,
        awayScore: result.awayScore,
        isPlayed: true,
        result: result.result
      };
    });

    return of(updatedMatches).pipe(delay(1500));
  }

  // Maç sonucu düzenleme
  editMatchResult(matches: Match[], matchId: number, homeScore: number, awayScore: number): Observable<Match[]> {
    const updatedMatches = matches.map(match => {
      if (match.id === matchId) {
        return {
          ...match,
          homeScore,
          awayScore,
          isPlayed: true,
          result: this.determineResult(homeScore, awayScore)
        };
      }
      return match;
    });

    return of(updatedMatches).pipe(delay(300));
  }

  // Şampiyonluk ihtimallerini hesaplama (Monte Carlo)
  calculateChampionshipChances(teams: Team[], remainingMatches: Match[]): Observable<{ [teamId: number]: number }> {
    if (remainingMatches.length === 0) {
      return of({});
    }

    const simulations = 1000;
    const championshipCounts: { [teamId: number]: number } = {};
    
    // Her takım için sayaç başlat
    teams.forEach(team => {
      championshipCounts[team.id] = 0;
    });

    // Monte Carlo simülasyonu
    for (let i = 0; i < simulations; i++) {
      const simulatedMatches = this.simulateRemainingMatches(remainingMatches);
      const finalStandings = this.calculateFinalStandings(teams, simulatedMatches);
      const champion = finalStandings[0];
      
      if (champion) {
        championshipCounts[champion.team.id]++;
      }
    }

    // Yüzdelere çevir
    const chances: { [teamId: number]: number } = {};
    teams.forEach(team => {
      chances[team.id] = (championshipCounts[team.id] / simulations) * 100;
    });

    return of(chances).pipe(delay(500));
  }

  // Yardımcı metodlar
  private getRandomTeamStrength(): number {
    const min = LEAGUE_CONSTANTS.TEAM_STRENGTH.MIN;
    const max = LEAGUE_CONSTANTS.TEAM_STRENGTH.MAX;
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  private getTeamStrengthById(teamId: number): number {
    // Gerçek uygulamada teams array'inden alınır
    return Math.floor(Math.random() * 5) + 1;
  }

  private simulateMatch(homeTeamId: number, awayTeamId: number, homeStrength: number, awayStrength: number) {
    // Ev sahibi avantajı (%30)
    const homeAdvantage = 0.3;
    const adjustedHomeStrength = homeStrength + homeAdvantage;
    
    const homeScore = this.generateGoalCount(adjustedHomeStrength);
    const awayScore = this.generateGoalCount(awayStrength);
    
    return {
      homeScore,
      awayScore,
      result: this.determineResult(homeScore, awayScore)
    };
  }

  private generateGoalCount(strength: number): number {
    // Takım gücüne göre gol sayısı hesaplama
    const baseChance = strength / 5;
    const random = Math.random();
    
    if (random < 0.1) return 0; // %10 şansla 0 gol
    if (random < 0.3 + (baseChance * 0.2)) return 1; // Güce göre 1 gol
    if (random < 0.7 + (baseChance * 0.15)) return 2; // 2 gol
    if (random < 0.9 + (baseChance * 0.1)) return 3; // 3 gol
    if (random < 0.98) return 4; // Nadir 4 gol
    return 5; // Çok nadir 5 gol
  }

  private determineResult(homeScore: number, awayScore: number): MatchResult {
    if (homeScore > awayScore) return MatchResult.HOME_WIN;
    if (awayScore > homeScore) return MatchResult.AWAY_WIN;
    return MatchResult.DRAW;
  }

  private generateFirstHalfMatches(teams: Team[]): Match[] {
    return this.generateRoundRobinFixtures(teams, 1, 1);
  }

  private generateSecondHalfMatches(firstHalfMatches: Match[]): Match[] {
    const numTeams = LEAGUE_CONSTANTS.TEAM_COUNT;
    const secondHalfStartWeek = numTeams - 1 + 1;
    const secondHalfStartMatchId = firstHalfMatches.length + 1;
    
    // İkinci yarıda ev sahibi değişir
    return firstHalfMatches.map((match, index) => ({
      id: secondHalfStartMatchId + index,
      week: match.week + (numTeams - 1),
      homeTeam: match.awayTeam, // Ev sahibi değişir
      awayTeam: match.homeTeam,
      homeScore: null,
      awayScore: null,
      isPlayed: false
    }));
  }

  private shuffleTeams(teams: Team[]): Team[] {
    const shuffled = [...teams];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  }

  private shuffleArray<T>(array: T[]): T[] {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  }

  private generateRoundRobinFixtures(teams: Team[], startWeek: number, startMatchId: number): Match[] {
    const matches: Match[] = [];
    const numTeams = teams.length;
    let matchId = startMatchId;
    
    const shuffledTeams = this.shuffleTeams([...teams]);
    const totalWeeks = numTeams - 1; // N-1 hafta
    const matchesPerWeek = numTeams / 2; // Her hafta N/2 maç

    for (let week = 0; week < totalWeeks; week++) {
      const weekNumber = startWeek + week;

      // Bu haftanın maçlarını oluştur
      for (let i = 0; i < matchesPerWeek; i++) {
        const homeTeam = shuffledTeams[i];
        const awayTeam = shuffledTeams[numTeams - 1 - i];

        matches.push({
          id: matchId++,
          week: weekNumber,
          homeTeam: { id: homeTeam.id, name: homeTeam.name },
          awayTeam: { id: awayTeam.id, name: awayTeam.name },
          homeScore: null,
          awayScore: null,
          isPlayed: false
        });
      }
      
      // Son hafta değilse takımları döndür
      if (week < totalWeeks - 1) {
        this.rotateTeams(shuffledTeams);
      }
    }
    
    return matches;
  }

  private rotateTeams(teams: Team[]): void {
    // İlk takımı sabit tut, diğerlerini döndür
    if (teams.length > 2) {
      const fixed = teams[0];
      const rotating = teams.slice(1);
      const last = rotating.pop();
      if (last) {
        rotating.unshift(last);
      }
      teams.splice(0, teams.length, fixed, ...rotating);
    }
  }

  private simulateRemainingMatches(matches: Match[]): Match[] {
    return matches.map(match => {
      const homeStrength = this.getTeamStrengthById(match.homeTeam.id);
      const awayStrength = this.getTeamStrengthById(match.awayTeam.id);
      
      const result = this.simulateMatch(
        match.homeTeam.id,
        match.awayTeam.id,
        homeStrength,
        awayStrength
      );

      return {
        ...match,
        homeScore: result.homeScore,
        awayScore: result.awayScore,
        isPlayed: true,
        result: result.result
      };
    });
  }

  private calculateFinalStandings(teams: Team[], simulatedMatches: Match[]): any[] {
    // Basit sıralama hesaplama - gerçek uygulamada daha karmaşık
    return teams.map(team => ({ team })).sort(() => Math.random() - 0.5);
  }
}
```

---

### 🏪 **4. NGRX STATE MANAGEMENT (2-3 saat)**

#### 4.1 Actions (src/app/store/league/league.actions.ts)
```typescript
import { createAction, props } from '@ngrx/store';
import { ITeam, IMatch, IMatchEdit } from '../../common/models';

/**
 * Liga başlatma action'ları
 */

// Liga başlatma
export const initializeLeague = createAction(
  '[League] Initialize League'
);

export const initializeLeagueSuccess = createAction(
  '[League] Initialize League Success',
  props<{ teams: ITeam[]; matches: IMatch[] }>()
);

export const initializeLeagueFailure = createAction(
  '[League] Initialize League Failure',
  props<{ error: string }>()
);

// Sonraki hafta
export const playNextWeek = createAction(
  '[League] Play Next Week'
);

export const playNextWeekSuccess = createAction(
  '[League] Play Next Week Success',
  props<{ matches: IMatch[]; currentWeek: number }>()
);

export const playNextWeekFailure = createAction(
  '[League] Play Next Week Failure',
  props<{ error: string }>()
);

// Tüm sezon
export const playAllSeason = createAction(
  '[League] Play All Season'
);

export const playAllSeasonSuccess = createAction(
  '[League] Play All Season Success',
  props<{ matches: IMatch[]; currentWeek: number }>()
);

export const playAllSeasonFailure = createAction(
  '[League] Play All Season Failure',
  props<{ error: string }>()
);

// Maç düzenleme
export const editMatchResult = createAction(
  '[League] Edit Match Result',
  props<{ matchEdit: IMatchEdit }>()
);

export const editMatchResultSuccess = createAction(
  '[League] Edit Match Result Success',
  props<{ matches: IMatch[] }>()
);

export const editMatchResultFailure = createAction(
  '[League] Edit Match Result Failure',
  props<{ error: string }>()
);

// Sıralama hesaplama
export const calculateStandings = createAction(
  '[League] Calculate Standings'
);

export const calculateStandingsSuccess = createAction(
  '[League] Calculate Standings Success'
);

// Liga sıfırlama
export const resetLeague = createAction(
  '[League] Reset League'
);

// Loading ve Error
export const setLoading = createAction(
  '[League] Set Loading',
  props<{ loading: boolean }>()
);

export const setError = createAction(
  '[League] Set Error',
  props<{ error: string }>()
);

export const clearError = createAction(
  '[League] Clear Error'
);
```

#### 4.2 Reducer (src/app/store/league/league.reducer.ts)
```typescript
import { createReducer, on } from '@ngrx/store';
import { ILeagueState, initialLeagueState } from '../../common/models/league-state.model';
import { LEAGUE_CONSTANTS } from '../../common/models/league.constants';
import * as LeagueActions from './league.actions';

/**
 * Liga reducer - State değişikliklerini yönetir
 */

export const leagueReducer = createReducer(
  initialLeagueState,
  
  // Liga başlatma
  on(LeagueActions.initializeLeague, (state) => ({
    ...state,
    loading: true,
    error: null
  })),
  
  on(LeagueActions.initializeLeagueSuccess, (state, { teams, matches }) => ({
    ...state,
    teams,
    matches,
    standings: calculateStandings(teams, matches),
    weeklyMatches: groupMatchesByWeek(matches),
    loading: false,
    error: null,
    currentWeek: 1,
    isSeasonFinished: false,
    champion: null
  })),
  
  on(LeagueActions.initializeLeagueFailure, (state, { error }) => ({
    ...state,
    loading: false,
    error
  })),
  
  // Sonraki hafta
  on(LeagueActions.playNextWeek, (state) => ({
    ...state,
    loading: true,
    error: null
  })),
  
  on(LeagueActions.playNextWeekSuccess, (state, { matches, currentWeek }) => {
    const updatedMatches = state.matches.map(match => {
      const updatedMatch = matches.find(m => m.id === match.id);
      return updatedMatch || match;
    });
    
    const updatedTeams = updateTeamsFromMatches(state.teams, updatedMatches);
    const updatedStandings = calculateStandings(updatedTeams, updatedMatches);
    const champion = currentWeek > LEAGUE_CONSTANTS.TOTAL_WEEKS ? 
      updatedStandings[0]?.team : null;
    
    return {
      ...state,
      matches: updatedMatches,
      teams: updatedTeams,
      standings: updatedStandings,
      weeklyMatches: groupMatchesByWeek(updatedMatches),
      currentWeek,
      isSeasonFinished: currentWeek > LEAGUE_CONSTANTS.TOTAL_WEEKS,
      champion,
      loading: false
    };
  }),
  
  on(LeagueActions.playNextWeekFailure, (state, { error }) => ({
    ...state,
    loading: false,
    error
  })),
  
  // Tüm sezon
  on(LeagueActions.playAllSeason, (state) => ({
    ...state,
    loading: true,
    error: null
  })),
  
  on(LeagueActions.playAllSeasonSuccess, (state, { matches, currentWeek }) => {
    const updatedMatches = state.matches.map(match => {
      const updatedMatch = matches.find(m => m.id === match.id);
      return updatedMatch || match;
    });
    
    const updatedTeams = updateTeamsFromMatches(state.teams, updatedMatches);
    const updatedStandings = calculateStandings(updatedTeams, updatedMatches);
    const champion = updatedStandings[0]?.team || null;
    
    return {
      ...state,
      matches: updatedMatches,
      teams: updatedTeams,
      standings: updatedStandings,
      weeklyMatches: groupMatchesByWeek(updatedMatches),
      currentWeek: LEAGUE_CONSTANTS.TOTAL_WEEKS + 1,
      isSeasonFinished: true,
      champion,
      loading: false
    };
  }),
  
  on(LeagueActions.playAllSeasonFailure, (state, { error }) => ({
    ...state,
    loading: false,
    error
  })),
  
  // Maç düzenleme
  on(LeagueActions.editMatchResult, (state) => ({
    ...state,
    loading: true,
    error: null
  })),
  
  on(LeagueActions.editMatchResultSuccess, (state, { matches }) => {
    const updatedMatches = state.matches.map(match => {
      const updatedMatch = matches.find(m => m.id === match.id);
      return updatedMatch || match;
    });
    
    const updatedTeams = updateTeamsFromMatches(state.teams, updatedMatches);
    const updatedStandings = calculateStandings(updatedTeams, updatedMatches);
    
    return {
      ...state,
      matches: updatedMatches,
      teams: updatedTeams,
      standings: updatedStandings,
      weeklyMatches: groupMatchesByWeek(updatedMatches),
      loading: false
    };
  }),
  
  on(LeagueActions.editMatchResultFailure, (state, { error }) => ({
    ...state,
    loading: false,
    error
  })),
  
  // Liga sıfırlama
  on(LeagueActions.resetLeague, () => initialLeagueState),
  
  // Loading ve Error
  on(LeagueActions.setLoading, (state, { loading }) => ({
    ...state,
    loading
  })),
  
  on(LeagueActions.setError, (state, { error }) => ({
    ...state,
    error,
    loading: false
  })),
  
  on(LeagueActions.clearError, (state) => ({
    ...state,
    error: null
  }))
);

// Yardımcı fonksiyonlar
function calculateStandings(teams: any[], matches: any[]): any[] {
  // Puan tablosu hesaplama mantığı
  const standings = teams.map(team => {
    const teamMatches = matches.filter(match => 
      (match.homeTeam.id === team.id || match.awayTeam.id === team.id) && match.isPlayed
    );
    
    let points = 0;
    let won = 0;
    let drawn = 0;
    let lost = 0;
    let goalsFor = 0;
    let goalsAgainst = 0;
    
    teamMatches.forEach(match => {
      if (match.homeTeam.id === team.id) {
        goalsFor += match.homeScore || 0;
        goalsAgainst += match.awayScore || 0;
        
        if ((match.homeScore || 0) > (match.awayScore || 0)) {
          points += LEAGUE_CONSTANTS.POINTS.WIN;
          won++;
        } else if ((match.homeScore || 0) === (match.awayScore || 0)) {
          points += LEAGUE_CONSTANTS.POINTS.DRAW;
          drawn++;
        } else {
          lost++;
        }
      } else {
        goalsFor += match.awayScore || 0;
        goalsAgainst += match.homeScore || 0;
        
        if ((match.awayScore || 0) > (match.homeScore || 0)) {
          points += LEAGUE_CONSTANTS.POINTS.WIN;
          won++;
        } else if ((match.awayScore || 0) === (match.homeScore || 0)) {
          points += LEAGUE_CONSTANTS.POINTS.DRAW;
          drawn++;
        } else {
          lost++;
        }
      }
    });
    
    return {
      team: {
        ...team,
        played: teamMatches.length,
        won,
        drawn,
        lost,
        goalsFor,
        goalsAgainst,
        goalDifference: goalsFor - goalsAgainst,
        points
      },
      position: 0,
      championshipChance: 0,
      isChampionshipPossible: true
    };
  });
  
  // Sıralama: puan, averaj, atılan gol
  standings.sort((a, b) => {
    if (b.team.points !== a.team.points) {
      return b.team.points - a.team.points;
    }
    if (b.team.goalDifference !== a.team.goalDifference) {
      return b.team.goalDifference - a.team.goalDifference;
    }
    return b.team.goalsFor - a.team.goalsFor;
  });
  
  // Pozisyonları güncelle
  standings.forEach((standing, index) => {
    standing.position = index + 1;
  });
  
  return standings;
}

function updateTeamsFromMatches(teams: any[], matches: any[]): any[] {
  return teams.map(team => {
    const teamMatches = matches.filter(match => 
      (match.homeTeam.id === team.id || match.awayTeam.id === team.id) && match.isPlayed
    );
    
    let points = 0;
    let won = 0;
    let drawn = 0;
    let lost = 0;
    let goalsFor = 0;
    let goalsAgainst = 0;
    
    teamMatches.forEach(match => {
      if (match.homeTeam.id === team.id) {
        goalsFor += match.homeScore || 0;
        goalsAgainst += match.awayScore || 0;
        
        if ((match.homeScore || 0) > (match.awayScore || 0)) {
          points += LEAGUE_CONSTANTS.POINTS.WIN;
          won++;
        } else if ((match.homeScore || 0) === (match.awayScore || 0)) {
          points += LEAGUE_CONSTANTS.POINTS.DRAW;
          drawn++;
        } else {
          lost++;
        }
      } else {
        goalsFor += match.awayScore || 0;
        goalsAgainst += match.homeScore || 0;
        
        if ((match.awayScore || 0) > (match.homeScore || 0)) {
          points += LEAGUE_CONSTANTS.POINTS.WIN;
          won++;
        } else if ((match.awayScore || 0) === (match.homeScore || 0)) {
          points += LEAGUE_CONSTANTS.POINTS.DRAW;
          drawn++;
        } else {
          lost++;
        }
      }
    });
    
    return {
      ...team,
      played: teamMatches.length,
      won,
      drawn,
      lost,
      goalsFor,
      goalsAgainst,
      goalDifference: goalsFor - goalsAgainst,
      points
    };
  });
}

function groupMatchesByWeek(matches: any[]): any[] {
  const grouped: { [week: number]: any[] } = {};
  
  matches.forEach(match => {
    if (!grouped[match.week]) {
      grouped[match.week] = [];
    }
    grouped[match.week].push(match);
  });
  
  return Object.keys(grouped).map(week => ({
    week: parseInt(week),
    matches: grouped[parseInt(week)]
  }));
}
```

---

### 🚀 **5. ANGULAR 20'YE GEÇİŞ (1-2 gün)**

#### 5.1 Güncelleme Komutları
```bash
# Angular 20'ye güncelleme
ng update @angular/core@20 @angular/cli@20

# NgRx 20'ye güncelleme  
ng update @ngrx/store@20 @ngrx/effects@20

# PrimeNG 19'a güncelleme
npm install primeng@19

# TypeScript güncelleme
npm install typescript@5.8.3

# Package.json kontrol
npm outdated
```

#### 5.2 Signals Kullanımı (Angular 20)
```typescript
// src/app/league/league-dashboard/league-dashboard.component.ts (Angular 20 versiyonu)
import { Component, OnInit, signal, computed, effect } from '@angular/core';
import { Store } from '@ngrx/store';
import * as LeagueActions from '../../store/league/league.actions';
import * as LeagueSelectors from '../../store/league/league.selectors';

@Component({
  selector: 'app-league-dashboard',
  templateUrl: './league-dashboard.component.html',
  styleUrls: ['./league-dashboard.component.scss']
})
export class LeagueDashboardComponent implements OnInit {
  
  // Signals (Angular 20)
  standings = signal<ITeamStats[]>([]);
  currentWeek = signal(1);
  loading = signal(false);
  error = signal<string | null>(null);
  
  // Computed values
  isSeasonFinished = computed(() => this.currentWeek() > 6);
  champion = computed(() => {
    const standings = this.standings();
    return standings.length > 0 ? standings[0].team : null;
  });
  
  // Store observables (NgRx ile birlikte kullanım)
  standings$ = this.store.select(LeagueSelectors.selectStandings);
  loading$ = this.store.select(LeagueSelectors.selectLoading);
  error$ = this.store.select(LeagueSelectors.selectError);

  constructor(private store: Store) {
    // Effect - signal değişikliklerini izle
    effect(() => {
      console.log('Current week changed:', this.currentWeek());
      console.log('Season finished:', this.isSeasonFinished());
    });
  }

  ngOnInit() {
    // Store'dan signals'a data aktarımı
    this.standings$.subscribe(standings => {
      this.standings.set(standings);
    });
    
    this.loading$.subscribe(loading => {
      this.loading.set(loading);
    });
    
    this.error$.subscribe(error => {
      this.error.set(error);
    });
    
    // Liga başlat
    this.store.dispatch(LeagueActions.initializeLeague());
  }

  // Signal updates
  playNextWeek() {
    this.currentWeek.update(week => week + 1);
    this.store.dispatch(LeagueActions.playNextWeek());
  }

  playAllSeason() {
    this.currentWeek.set(7); // Sezon bitir
    this.store.dispatch(LeagueActions.playAllSeason());
  }

  resetLeague() {
    this.currentWeek.set(1);
    this.standings.set([]);
    this.error.set(null);
    this.store.dispatch(LeagueActions.resetLeague());
  }

  clearError() {
    this.error.set(null);
    this.store.dispatch(LeagueActions.clearError());
  }
}
```

#### 5.3 Control Flow (Angular 20)
```html
<!-- src/app/league/league-dashboard/league-dashboard.component.html (Angular 20) -->
<div class="league-dashboard">
  <!-- Angular 20 Control Flow -->
  @if (loading()) {
    <div class="loading-spinner">
      <p-progressBar mode="indeterminate"></p-progressBar>
      <p>Loading...</p>
    </div>
  } @else if (error()) {
    <div class="error-message">
      <p-message severity="error" [text]="error()"></p-message>
      <button pButton type="button" label="Hatayı Temizle" 
              (click)="clearError()"></button>
    </div>
  } @else {
    <!-- Liga içeriği -->
    <div class="league-content">
      
      <!-- Liga kontrolleri -->
      <div class="league-controls">
        @if (!isSeasonFinished()) {
          <button pButton type="button" 
                  label="Sonraki Haftayı Oynat ({{ currentWeek() }})"
                  (click)="playNextWeek()"
                  [disabled]="loading()">
          </button>
          
          <button pButton type="button" 
                  label="Tüm Sezonu Oynat"
                  (click)="playAllSeason()"
                  [disabled]="loading()">
          </button>
        }
        
        <button pButton type="button" 
                label="Ligayı Sıfırla"
                (click)="resetLeague()"
                [disabled]="loading()">
        </button>
      </div>

      <!-- Puan Tablosu -->
      <div class="standings-container">
        <h3>Puan Tablosu</h3>
        @if (standings().length > 0) {
          <div class="standings-table">
            @for (standing of standings(); track standing.team.id) {
              <div class="team-row" 
                   [class]="'team-' + standing.team.name.toLowerCase()">
                <span class="position">{{ standing.position }}</span>
                <span class="team-name">{{ standing.team.name }}</span>
                <span class="points">{{ standing.team.points }} puan</span>
                <span class="matches">{{ standing.team.played }} maç</span>
                <span class="goal-diff">{{ standing.team.goalDifference > 0 ? '+' : '' }}{{ standing.team.goalDifference }}</span>
              </div>
            }
          </div>
        } @else {
          <p>Henüz maç oynanmadı.</p>
        }
      </div>

      <!-- Şampiyon kutlaması -->
      @if (isSeasonFinished() && champion()) {
        <div class="champion-announcement">
          <div class="champion-card">
            <h1>🏆 ŞAMPİYON: {{ champion()?.name }}</h1>
            <p>Tebrikler! {{ champion()?.name }} şampiyon oldu!</p>
          </div>
        </div>
      }
      
    </div>
  }
</div>
```

---

## 🎯 **ANGULAR 18 vs 20 KARŞILAŞTIRMASI**

### Template Syntax
```html
<!-- Angular 18 -->
<div *ngIf="loading$ | async">Loading...</div>
<div *ngFor="let item of items$ | async">{{ item.name }}</div>

<!-- Angular 20 -->
@if (loading()) {
  <div>Loading...</div>
}
@for (item of items(); track item.id) {
  <div>{{ item.name }}</div>
}
```

### State Management
```typescript
// Angular 18 - RxJS Observables
standings$ = this.store.select(selectStandings);
loading$ = this.store.select(selectLoading);

// Angular 20 - Signals
standings = signal<TeamStats[]>([]);
loading = signal(false);
isSeasonFinished = computed(() => this.currentWeek() > 6);
```

### Component Updates
```typescript
// Angular 18 - Subscription based
ngOnInit() {
  this.standings$.subscribe(standings => {
    this.currentStandings = standings;
  });
}

// Angular 20 - Signal based
ngOnInit() {
  effect(() => {
    console.log('Standings changed:', this.standings());
  });
}
```

---

## 🔧 **GEREKLI PAKETLER VE KONFIGÜRASYON**

### package.json (Angular 18)
- Yukarıdaki JSON'ı kullanın

### angular.json konfigürasyonu
```json
{
  "projects": {
    "futbol-ligi-simulasyonu": {
      "architect": {
        "build": {
          "options": {
            "styles": [
              "node_modules/bootstrap/dist/css/bootstrap.min.css",
              "node_modules/primeicons/primeicons.css",
              "node_modules/primeng/resources/themes/lara-light-indigo/theme.css",
              "node_modules/primeng/resources/primeng.min.css",
              "src/styles.scss"
            ]
          }
        }
      }
    }
  }
}
```

### tailwind.config.js
```javascript
module.exports = {
  content: [
    "./src/**/*.{html,ts}",
  ],
  theme: {
    extend: {
      colors: {
        'galatasaray': '#FF6B35',
        'fenerbahce': '#FFD700',
        'besiktas': '#000000',
        'trabzonspor': '#8B0000'
      }
    },
  },
  plugins: [],
}
```

### styles.scss
```scss
@import 'tailwindcss/base';
@import 'tailwindcss/components';
@import 'tailwindcss/utilities';

// Custom team colors
.team-galatasaray {
  background-color: #FF6B35;
  color: white;
}

.team-fenerbahce {
  background-color: #FFD700;
  color: #1e3a8a;
}

.team-besiktas {
  background-color: #000000;
  color: white;
}

.team-trabzonspor {
  background-color: #8B0000;
  color: white;
}

// Animations
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.fade-in {
  animation: fadeIn 0.5s ease-in-out;
}
```

---

## ✅ **GELIŞTIRME SÜRECI KONTROLÜ**

### Adım 1 ✅ - Kurulum (30 dk)
- [ ] Angular CLI 18 kuruldu
- [ ] Proje oluşturuldu  
- [ ] Paketler yüklendi
- [ ] Klasörler oluşturuldu

### Adım 2 ✅ - Modeller (45 dk)
- [ ] team.model.ts oluşturuldu
- [ ] match.model.ts oluşturuldu
- [ ] league.constants.ts oluşturuldu
- [ ] league-state.model.ts oluşturuldu

### Adım 3 ✅ - Servis (2-3 saat)
- [ ] LeagueSimulationService oluşturuldu
- [ ] Round Robin algoritması yazıldı
- [ ] Maç simülasyonu implementasyonu
- [ ] Monte Carlo hesaplaması

### Adım 4 ✅ - NgRx (2-3 saat)
- [ ] Actions tanımlandı
- [ ] Reducer yazıldı
- [ ] Effects oluşturuldu
- [ ] Selectors hazırlandı

### Adım 5 ✅ - Angular 20 Geçiş (1-2 gün)
- [ ] Angular 20'ye güncelleme
- [ ] Signals implementasyonu
- [ ] Control Flow syntax
- [ ] Karşılaştırmalı test

---

## 🎉 **SONUÇ**

Bu rehber ile:
1. **Angular 18** ile başlayıp temel kavramları öğreneceksiniz
2. **NgRx state management** ile modern state yönetimi
3. **Angular 20** ile yeni özellikleri deneyimleyeceksiniz
4. **Karşılaştırmalı öğrenme** ile farkları göreceksiniz

**Kopya-yapıştır kod örnekleri** ile hızlı geliştirme yapabilir, her adımda neyin neden yazıldığını anlayabilirsiniz.

**İyi kodlamalar! ⚽🚀**
